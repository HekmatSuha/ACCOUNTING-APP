{"ast":null,"code":"// frontend/src/utils/axiosInstance.js\n\nimport axios from 'axios';\nimport { jwtDecode } from 'jwt-decode';\nimport dayjs from 'dayjs';\nconst baseURL = 'http://127.0.0.1:8000/api';\nconst axiosInstance = axios.create({\n  baseURL\n});\n\n// Interceptor to add the token to every request\naxiosInstance.interceptors.request.use(async req => {\n  let accessToken = localStorage.getItem('accessToken');\n  if (!accessToken) {\n    return req;\n  }\n  const user = jwtDecode(accessToken);\n  const isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\n  if (!isExpired) {\n    req.headers.Authorization = `Bearer ${accessToken}`;\n    return req;\n  }\n\n  // Token is expired, try to refresh it\n  const refreshToken = localStorage.getItem('refreshToken');\n  try {\n    const response = await axios.post(`${baseURL}/token/refresh/`, {\n      refresh: refreshToken\n    });\n    localStorage.setItem('accessToken', response.data.access);\n    req.headers.Authorization = `Bearer ${response.data.access}`;\n    return req;\n  } catch (error) {\n    // If refresh fails, log the user out\n    localStorage.removeItem('accessToken');\n    localStorage.removeItem('refreshToken');\n    window.location.href = '/login';\n  }\n  return req;\n});\n\n// You need to install these new packages\n// npm install jwt-decode dayjs\n\nexport default axiosInstance;","map":{"version":3,"names":["axios","jwtDecode","dayjs","baseURL","axiosInstance","create","interceptors","request","use","req","accessToken","localStorage","getItem","user","isExpired","unix","exp","diff","headers","Authorization","refreshToken","response","post","refresh","setItem","data","access","error","removeItem","window","location","href"],"sources":["E:/BizimHesap/accounting-app/frontend/src/utils/axiosInstance.js"],"sourcesContent":["// frontend/src/utils/axiosInstance.js\r\n\r\nimport axios from 'axios';\r\nimport { jwtDecode } from 'jwt-decode';\r\nimport dayjs from 'dayjs';\r\n\r\nconst baseURL = 'http://127.0.0.1:8000/api';\r\n\r\nconst axiosInstance = axios.create({\r\n    baseURL,\r\n});\r\n\r\n// Interceptor to add the token to every request\r\naxiosInstance.interceptors.request.use(async req => {\r\n    let accessToken = localStorage.getItem('accessToken');\r\n    \r\n    if (!accessToken) {\r\n        return req;\r\n    }\r\n\r\n    const user = jwtDecode(accessToken);\r\n    const isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\r\n\r\n    if (!isExpired) {\r\n        req.headers.Authorization = `Bearer ${accessToken}`;\r\n        return req;\r\n    }\r\n\r\n    // Token is expired, try to refresh it\r\n    const refreshToken = localStorage.getItem('refreshToken');\r\n    try {\r\n        const response = await axios.post(`${baseURL}/token/refresh/`, {\r\n            refresh: refreshToken\r\n        });\r\n        \r\n        localStorage.setItem('accessToken', response.data.access);\r\n        req.headers.Authorization = `Bearer ${response.data.access}`;\r\n        return req;\r\n\r\n    } catch (error) {\r\n        // If refresh fails, log the user out\r\n        localStorage.removeItem('accessToken');\r\n        localStorage.removeItem('refreshToken');\r\n        window.location.href = '/login'; \r\n    }\r\n\r\n    return req;\r\n});\r\n\r\n// You need to install these new packages\r\n// npm install jwt-decode dayjs\r\n\r\nexport default axiosInstance;"],"mappings":"AAAA;;AAEA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,SAAS,QAAQ,YAAY;AACtC,OAAOC,KAAK,MAAM,OAAO;AAEzB,MAAMC,OAAO,GAAG,2BAA2B;AAE3C,MAAMC,aAAa,GAAGJ,KAAK,CAACK,MAAM,CAAC;EAC/BF;AACJ,CAAC,CAAC;;AAEF;AACAC,aAAa,CAACE,YAAY,CAACC,OAAO,CAACC,GAAG,CAAC,MAAMC,GAAG,IAAI;EAChD,IAAIC,WAAW,GAAGC,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC;EAErD,IAAI,CAACF,WAAW,EAAE;IACd,OAAOD,GAAG;EACd;EAEA,MAAMI,IAAI,GAAGZ,SAAS,CAACS,WAAW,CAAC;EACnC,MAAMI,SAAS,GAAGZ,KAAK,CAACa,IAAI,CAACF,IAAI,CAACG,GAAG,CAAC,CAACC,IAAI,CAACf,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC;EAExD,IAAI,CAACY,SAAS,EAAE;IACZL,GAAG,CAACS,OAAO,CAACC,aAAa,GAAG,UAAUT,WAAW,EAAE;IACnD,OAAOD,GAAG;EACd;;EAEA;EACA,MAAMW,YAAY,GAAGT,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC;EACzD,IAAI;IACA,MAAMS,QAAQ,GAAG,MAAMrB,KAAK,CAACsB,IAAI,CAAC,GAAGnB,OAAO,iBAAiB,EAAE;MAC3DoB,OAAO,EAAEH;IACb,CAAC,CAAC;IAEFT,YAAY,CAACa,OAAO,CAAC,aAAa,EAAEH,QAAQ,CAACI,IAAI,CAACC,MAAM,CAAC;IACzDjB,GAAG,CAACS,OAAO,CAACC,aAAa,GAAG,UAAUE,QAAQ,CAACI,IAAI,CAACC,MAAM,EAAE;IAC5D,OAAOjB,GAAG;EAEd,CAAC,CAAC,OAAOkB,KAAK,EAAE;IACZ;IACAhB,YAAY,CAACiB,UAAU,CAAC,aAAa,CAAC;IACtCjB,YAAY,CAACiB,UAAU,CAAC,cAAc,CAAC;IACvCC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,QAAQ;EACnC;EAEA,OAAOtB,GAAG;AACd,CAAC,CAAC;;AAEF;AACA;;AAEA,eAAeL,aAAa","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}